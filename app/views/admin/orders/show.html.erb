<%= render 'admin/header' %>
<div class="container">
	<h2>注文履歴詳細</h2><br><br><br>

	<table class="table table-borderless">
		<tr>
			<td><b>購入者</b></td>
			<td><%= @order.customer.last_name %><%= @order.customer.first_name %></td>
		</tr>
		<tr>
			<td><b>配送先</b></td>
			<td>〒<%= @order.postal_code %> <%= @order.address %> <br> <%= @order.name %></td>
		</tr>
		<tr>
			<td><b>支払方法</b></td>
			<td><%= @order.payment_method %></td>
		</tr>
		<tr>
			<td><b>注文ステータス</b></td>
			<td>
				<%= form_with model: @order, url: admin_order_path(@order), local: true do |f| %>
					<div class="row">
						<div class="col-md-4">
							<%= f.select :status, Order.statuses.keys, {}, {class:"custom-select"} %>
						</div>
						<div class="col-md-4">
							<%= f.submit "更新", class: "btn btn-primary" %>
						</div>
					</div>
				<% end %>
			</td>
		</tr>
	</table>
	<div class="row">
		<div class="col-md-8">
			<table class="table">
				<thead>
					<th>商品名</th>
					<th>単価（税込）</th>
					<th>数量</th>
					<th>小計</th>
					<th>製作ステータス</th>
					<th></th>
				</thead>
				<tbody>
					<% @order.order_details.each do |orderdetail| %>
						<tr>
							<td><%= orderdetail.item.name %></td>
							<td><%= orderdetail.price %></td>
							<td><%= orderdetail.amount %></td>
							<td><%= orderdetail.price * orderdetail.amount %></td>
							<%= form_with model:orderdetail, url:admin_order_order_detail_path(@order, orderdetail), local: true do |f| %>
								<td><%= f.select :making_status, OrderDetail.making_statuses.keys, {}, {class:"custom-select"} %></td>
								<td><%= f.submit "更新", class: "btn btn-primary" %></td>
							<% end %>
						</tr>
					<% end %>
				</tbody>
			</table><br><br><br><br>
		</div>
		<div class="col-md-4">
			<table class="table table-borderless">
				<tr>
					<td><b>商品合計</b></td>
					<td><%= @order.total_payment - @order.shipping_cost %>円</td>
				</tr>
				<tr>
					<td><b>送料</b></td>
					<td><%= @order.shipping_cost %>円</td>
				</tr>
				<tr>
					<td><b>請求金額合計</b></td>
					<td><%= @order.total_payment %>円</td>
				</tr>
			</table>
		</div>
	</div>

</div>